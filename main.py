# -*- encoding: utf-8 -*-                                                                                                                                    

import json,gzip,re,itertools,sys
import cabocha

# çµµæ–‡å­—ã®æ­£è¦è¡¨ç¾  æ–°ã—ã„çµµæ–‡å­—ã‚’ã©ã‚“ã©ã‚“è¿½åŠ ã—ã‚ˆã†
# twitterã§ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ä¸€è¦§ï¼š http://jp.piliapp.com/emoji/list/

# ãƒ„ã‚¤ãƒ¼ãƒˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿
file_path = sys.argv[1]
file_name = file_path.split("/")[-1]
print file_name

def tweet_iter():
    with gzip.open(file_path) as f:
        for line in f:
            j = json.loads(line.strip())
            yield  j[u"text"]    

#  çµµæ–‡å­—ã®ãƒªã‚¹ãƒˆ
emoji_list = [u'ğŸ˜€',u'ğŸ˜›',u'ğŸ˜¸',u'ğŸ‘·',u'ğŸ’‹',u'ğŸ˜',u'ğŸ˜œ',u'ğŸ˜¹',u'ğŸ‘¸',u'ğŸ‘…',u'ğŸ˜‚',u'ğŸ˜',u'ğŸ˜º',u'ğŸ’‚',u'ğŸ’…'
                      ,u'ğŸ˜ƒ',u'ğŸ˜',u'ğŸ˜»',u'ğŸ‘¼',u'ğŸ‘‹',u'ğŸ˜„',u'ğŸ˜Ÿ',u'ğŸ˜¼',u'ğŸ…',u'ğŸ‘',u'ğŸ˜…',u'ğŸ˜ ',u'ğŸ˜½',u'ğŸ‘»',u'ğŸ‘'
                      ,u'ğŸ˜†',u'ğŸ˜¡',u'ğŸ˜¾',u'ğŸ‘¹',u'ğŸ˜‡',u'ğŸ˜¢',u'ğŸ˜¿',u'ğŸ‘º',u'ğŸ‘†',u'ğŸ˜ˆ',u'ğŸ˜£',u'ğŸ™€',u'ğŸ’©',u'ğŸ‘‡',u'ğŸ‘¿'
                      ,u'ğŸ˜¤',u'ğŸ‘£',u'ğŸ’€',u'ğŸ‘ˆ',u'ğŸ˜‰',u'ğŸ˜¥',u'ğŸ‘¤',u'ğŸ‘½',u'ğŸ‘‰',u'ğŸ˜Š',u'ğŸ˜¦',u'ğŸ‘¥',u'ğŸ‘¾',u'ğŸ‘Œ',u'ğŸ˜§'
                      ,u'ğŸ‘¦',u'ğŸ™‡',u'ğŸ˜‹',u'ğŸ˜¨',u'ğŸ‘§',u'ğŸ’',u'ğŸ‘Š',u'ğŸ˜Œ',u'ğŸ˜©',u'ğŸ‘¨',u'ğŸ™…',u'âœŠ',u'ğŸ˜',u'ğŸ˜ª',u'ğŸ‘©'
                      ,u'ğŸ™†',u'âœ‹',u'ğŸ˜',u'ğŸ˜«',u'ğŸ‘ª',u'ğŸ™‹',u'ğŸ’ª',u'ğŸ˜',u'ğŸ˜¬',u'ğŸ‘«',u'ğŸ™',u'ğŸ‘',u'ğŸ˜',u'ğŸ˜­',u'ğŸ‘¬'
                      ,u'ğŸ™',u'ğŸ™',u'ğŸ˜‘',u'ğŸ˜®',u'ğŸ‘­',u'ğŸ’†',u'ğŸ˜’',u'ğŸ˜¯',u'ğŸ‘®',u'ğŸ’‡',u'ğŸ˜“',u'ğŸ˜°',u'ğŸ‘¯',u'ğŸ’‘',u'ğŸ˜”'
                      ,u'ğŸ˜±',u'ğŸ‘°',u'ğŸ’',u'ğŸ˜•',u'ğŸ˜²',u'ğŸ‘±',u'ğŸ™Œ',u'ğŸ˜–',u'ğŸ˜³',u'ğŸ‘²',u'ğŸ‘',u'ğŸ˜—',u'ğŸ˜´',u'ğŸ‘³',u'ğŸ‘‚'
                      ,u'ğŸ˜˜',u'ğŸ˜µ',u'ğŸ‘´',u'ğŸ‘€',u'ğŸ˜™',u'ğŸ˜¶',u'ğŸ‘µ',u'ğŸ‘ƒ',u'ğŸ˜š',u'ğŸ˜·',u'ğŸ‘¶',u'ğŸ‘„',u'ğŸŒ±',u'ğŸŒ²',u'ğŸŒ³'
                      ,u'ğŸŒ´',u'ğŸŒµ',u'ğŸŒ·',u'ğŸŒ¸',u'ğŸŒ¹',u'ğŸŒº',u'ğŸŒ»',u'ğŸŒ¼',u'ğŸ’',u'ğŸŒ¾',u'ğŸŒ¿',u'ğŸ€',u'ğŸ',u'ğŸ‚',u'ğŸƒ'
                      ,u'ğŸ„',u'ğŸŒ°',u'ğŸ€',u'ğŸ',u'ğŸ­',u'ğŸ¹',u'ğŸ‚',u'ğŸƒ',u'ğŸ„',u'ğŸ®',u'ğŸ…',u'ğŸ†',u'ğŸ¯',u'ğŸ‡',u'ğŸ°'
                      ,u'ğŸˆ',u'ğŸ±',u'ğŸ',u'ğŸ´',u'ğŸ',u'ğŸ‘',u'ğŸ',u'ğŸ“',u'ğŸ”',u'ğŸ¤',u'ğŸ£',u'ğŸ¥',u'ğŸ¦',u'ğŸ§',u'ğŸ˜'
                      ,u'ğŸª',u'ğŸ«',u'ğŸ—',u'ğŸ–',u'ğŸ·',u'ğŸ½',u'ğŸ•',u'ğŸ©',u'ğŸ¶',u'ğŸº',u'ğŸ»',u'ğŸ¨',u'ğŸ¼',u'ğŸµ',u'ğŸ™ˆ'
                      ,u'ğŸ™‰',u'ğŸ™Š',u'ğŸ’',u'ğŸ‰',u'ğŸ²',u'ğŸŠ',u'ğŸ',u'ğŸ¢',u'ğŸ¸',u'ğŸ‹',u'ğŸ³',u'ğŸ¬',u'ğŸ™',u'ğŸŸ',u'ğŸ '
                      ,u'ğŸ¡',u'ğŸš',u'ğŸŒ',u'ğŸ›',u'ğŸœ',u'ğŸ',u'ğŸ',u'ğŸ¾',u'âš¡ï¸',u'ğŸ”¥',u'ğŸŒ™',u'â˜€ï¸',u'â›…',u'â˜ï¸',u'ğŸ’§'
                      ,u'ğŸ’¦',u'â˜”',u'ğŸ’¨',u'ğŸŒŸ',u'â­',u'ğŸŒ ',u'ğŸŒ„',u'ğŸŒ…',u'ğŸŒˆ',u'ğŸŒŠ',u'ğŸŒ‹',u'ğŸŒŒ',u'ğŸ—»',u'ğŸ—¾',u'ğŸŒ'
                      ,u'ğŸŒ',u'ğŸŒ',u'ğŸŒ',u'ğŸŒ‘',u'ğŸŒ’',u'ğŸŒ“',u'ğŸŒ”',u'ğŸŒ•',u'ğŸŒ–',u'ğŸŒ—',u'ğŸŒ˜',u'ğŸŒš',u'ğŸŒ',u'ğŸŒ›',u'ğŸŒœ'
                      ,u'ğŸŒ',u'ğŸ…',u'ğŸ†',u'ğŸŒ½',u'ğŸ ',u'ğŸ‡',u'ğŸˆ',u'ğŸ‰',u'ğŸŠ',u'ğŸ‹',u'ğŸŒ',u'ğŸ',u'ğŸ',u'ğŸ',u'ğŸ'
                      ,u'ğŸ‘',u'ğŸ“',u'ğŸ’',u'ğŸ”',u'ğŸ•',u'ğŸ–',u'ğŸ—',u'ğŸ˜',u'ğŸ™',u'ğŸš',u'ğŸ›',u'ğŸœ',u'ğŸ',u'ğŸ',u'ğŸŸ'
                      ,u'ğŸ¡',u'ğŸ¢',u'ğŸ£',u'ğŸ¤',u'ğŸ¥',u'ğŸ¦',u'ğŸ§',u'ğŸ¨',u'ğŸ©',u'ğŸª',u'ğŸ«',u'ğŸ¬',u'ğŸ­',u'ğŸ®',u'ğŸ¯'
                      ,u'ğŸ°',u'ğŸ±',u'ğŸ²',u'ğŸ³',u'ğŸ´',u'ğŸµ',u'â˜•',u'ğŸ¶',u'ğŸ·',u'ğŸ¸',u'ğŸ¹',u'ğŸº',u'ğŸ»',u'ğŸ¼',u'ğŸ‚'
                      ,u'ğŸƒ',u'ğŸ„',u'ğŸ‹',u'ğŸ',u'ğŸ‘',u'ğŸ†',u'ğŸ‡',u'ğŸ‰',u'ğŸŠ',u'ğŸˆ',u'ğŸ’«',u'âœ¨',u'ğŸ’¥',u'ğŸ“',u'ğŸ‘‘'
                      ,u'ğŸ',u'ğŸ',u'ğŸ',u'ğŸŒ',u'ğŸ®',u'ğŸ’',u'ğŸ’”',u'ğŸ’Œ',u'ğŸ’•',u'ğŸ’',u'ğŸ’“',u'ğŸ’—',u'ğŸ’–',u'ğŸ’˜',u'ğŸ’'
                      ,u'ğŸ’Ÿ',u'ğŸ’œ',u'ğŸ’›',u'ğŸ’š',u'ğŸ’™',u'ğŸƒ',u'ğŸš¶',u'ğŸ’ƒ',u'ğŸš£',u'ğŸŠ',u'ğŸ„',u'ğŸ›€',u'ğŸ‚',u'ğŸ¿',u'â›„'
                      ,u'ğŸš´',u'ğŸšµ',u'ğŸ‡',u'â›º',u'ğŸ£',u'âš½',u'ğŸ€',u'ğŸˆ',u'âš¾ï¸',u'ğŸ¾',u'ğŸ‰',u'â›³',u'ğŸ†',u'ğŸ½',u'ğŸ'
                      ,u'ğŸ¹',u'ğŸ¸',u'ğŸ»',u'ğŸ·',u'ğŸº',u'ğŸµ',u'ğŸ¶',u'ğŸ¼',u'ğŸ§',u'ğŸ¤',u'ğŸ­',u'ğŸ«',u'ğŸ©',u'ğŸª',u'ğŸ¬'
                      ,u'ğŸ¨',u'ğŸ¯',u'ğŸ±',u'ğŸ³',u'ğŸ°',u'ğŸ²',u'ğŸ®',u'ğŸ´',u'ğŸƒ',u'ğŸ€„',u'ğŸ ',u'ğŸ¡',u'ğŸ¢',u'ğŸšƒ',u'ğŸš'
                      ,u'ğŸš‚',u'ğŸš‹',u'ğŸš',u'ğŸš„',u'ğŸš…',u'ğŸš†',u'ğŸš‡',u'ğŸšˆ',u'ğŸš‰',u'ğŸšŠ',u'ğŸšŒ',u'ğŸš',u'ğŸš',u'ğŸš',u'ğŸš‘'
                      ,u'ğŸš’',u'ğŸš“',u'ğŸš”',u'ğŸš¨',u'ğŸš•',u'ğŸš–',u'ğŸš—',u'ğŸš˜',u'ğŸš™',u'ğŸšš',u'ğŸš›',u'ğŸšœ',u'ğŸš²',u'ğŸš',u'â›½'
                      ,u'ğŸš§',u'ğŸš¦',u'ğŸš¥',u'ğŸš€',u'ğŸš',u'ğŸ’º',u'âš“',u'ğŸš¢',u'ğŸš¤',u'â›µ',u'ğŸš¡',u'ğŸš ',u'ğŸšŸ',u'ğŸ›‚',u'ğŸ›ƒ'
                      ,u'ğŸ›„',u'ğŸ›…',u'ğŸ’´',u'ğŸ’¶',u'ğŸ’·',u'ğŸ’µ',u'ğŸ—½',u'ğŸ—¿',u'ğŸŒ',u'ğŸ—¼',u'â›²',u'ğŸ°',u'ğŸ¯',u'ğŸŒ‡',u'ğŸŒ†'
                      ,u'ğŸŒƒ',u'ğŸŒ‰',u'ğŸ ',u'ğŸ¡',u'ğŸ¢',u'ğŸ¬',u'ğŸ­',u'ğŸ£',u'ğŸ¤',u'ğŸ¥',u'ğŸ¨',u'ğŸ©',u'ğŸ’’',u'â›ª',u'ğŸª'
                      ,u'âŒš',u'ğŸ“±',u'ğŸ“²',u'ğŸ’»',u'â°',u'â³',u'âŒ›',u'ğŸ“·',u'ğŸ“¹',u'ğŸ¥',u'ğŸ“º',u'ğŸ“»',u'ğŸ“Ÿ',u'ğŸ“',u'ğŸ“ '
                      ,u'ğŸ’½',u'ğŸ’¾',u'ğŸ’¿',u'ğŸ“€',u'ğŸ“¼',u'ğŸ”‹',u'ğŸ”Œ',u'ğŸ’¡',u'ğŸ”¦',u'ğŸ“¡',u'ğŸ’³',u'ğŸ’¸',u'ğŸ’°',u'ğŸ’',u'ğŸŒ‚'
                      ,u'ğŸ‘',u'ğŸ‘›',u'ğŸ‘œ',u'ğŸ’¼',u'ğŸ’',u'ğŸ’„',u'ğŸ‘“',u'ğŸ‘’',u'ğŸ‘¡',u'ğŸ‘ ',u'ğŸ‘¢',u'ğŸ‘',u'ğŸ‘Ÿ',u'ğŸ‘™',u'ğŸ‘—'
                      ,u'ğŸ‘˜',u'ğŸ‘š',u'ğŸ‘•',u'ğŸ‘”',u'ğŸ‘–',u'ğŸšª',u'ğŸš¿',u'ğŸ›',u'ğŸš½',u'ğŸ’ˆ',u'ğŸ’‰',u'ğŸ’Š',u'ğŸ”¬',u'ğŸ”­',u'ğŸ”®'
                      ,u'ğŸ”§',u'ğŸ”ª',u'ğŸ”©',u'ğŸ”¨',u'ğŸ’£',u'ğŸš¬',u'ğŸ”«',u'ğŸ”–',u'ğŸ“°',u'ğŸ”‘',u'ğŸ“©',u'ğŸ“¨',u'ğŸ“§',u'ğŸ“¥',u'ğŸ“¤'
                      ,u'ğŸ“¦',u'ğŸ“¯',u'ğŸ“®',u'ğŸ“ª',u'ğŸ“«',u'ğŸ“¬',u'ğŸ“­',u'ğŸ“„',u'ğŸ“ƒ',u'ğŸ“‘',u'ğŸ“ˆ',u'ğŸ“‰',u'ğŸ“Š',u'ğŸ“…',u'ğŸ“†'
                      ,u'ğŸ”…',u'ğŸ”†',u'ğŸ“œ',u'ğŸ“‹',u'ğŸ“–',u'ğŸ““',u'ğŸ“”',u'ğŸ“’',u'ğŸ“•',u'ğŸ“—',u'ğŸ“˜',u'ğŸ“™',u'ğŸ“š',u'ğŸ“‡',u'ğŸ”—'
                      ,u'ğŸ“',u'ğŸ“Œ',u'ğŸ“',u'ğŸ“',u'ğŸ“',u'ğŸš©',u'ğŸ“',u'ğŸ“‚',u'ğŸ“',u'ğŸ”',u'ğŸ”',u'ğŸ”’',u'ğŸ”“',u'ğŸ“£',u'ğŸ“¢'
                      ,u'ğŸ”ˆ',u'ğŸ”‰',u'ğŸ”Š',u'ğŸ”‡',u'ğŸ’¤',u'ğŸ””',u'ğŸ”•',u'ğŸ’­',u'ğŸ’¬',u'ğŸš¸',u'ğŸ”',u'ğŸ”',u'ğŸ',u'ğŸš«',u'â›”'
                      ,u'ğŸ“›',u'ğŸš·',u'ğŸš¯',u'ğŸš³',u'ğŸš±',u'ğŸ“µ',u'ğŸ”',u'ğŸ‰‘',u'ğŸ‰',u'ğŸ’®',u'ãŠ—ï¸',u'â•',u'â–',u'ã€°ï¸',u'â—'
                      ,u'ğŸ”ƒ',u'ğŸ’±',u'ğŸ’²',u'â°',u'â¿',u'ã€½ï¸',u'â—',u'â“',u'â•',u'â”',u'âŒ',u'â­•',u'ğŸ’¯',u'ğŸ”š',u'ğŸ”™'
                      ,u'ğŸ”›',u'ğŸ”',u'ğŸ”œ',u'ğŸŒ€',u'â“‚ï¸',u'â›',u'ğŸ”¯',u'ğŸ”°',u'ğŸ”±',u'âš ï¸',u'â™»ï¸',u'ğŸ’¢',u'ğŸ’ ',u'âšªï¸',u'âš«ï¸'
                      ,u'ğŸ”˜',u'ğŸ”´',u'ğŸ”µ',u'ğŸ”º',u'ğŸ”»',u'ğŸ”¸',u'ğŸ”¹',u'ğŸ”¶',u'ğŸ”·',u'â¬›',u'â¬œ',u'â—¾',u'â—½ï¸',u'ğŸ”²',u'ğŸ”³'
                      ,u'ğŸ•',u'ğŸ•œ',u'ğŸ•‘',u'ğŸ•',u'ğŸ•’',u'ğŸ•',u'ğŸ•“',u'ğŸ•Ÿ',u'ğŸ•”',u'ğŸ• ',u'ğŸ••',u'ğŸ•¡',u'ğŸ•–',u'ğŸ•¢',u'ğŸ•—'
                      ,u'ğŸ•£',u'ğŸ•˜',u'ğŸ•¤',u'ğŸ•™',u'ğŸ•¥',u'ğŸ•¦',u'ğŸ•›',u'ğŸ•§',u'ğŸˆ´',u'ğŸˆµ',u'ğŸˆ²',u'ğŸˆ¶',u'ğŸˆš',u'ğŸˆ¸',u'ğŸˆº'
                      ,u'ğŸˆ¹',u'ğŸˆ³',u'ğŸˆ',u'ğŸˆ¯',u'ğŸ’¹',u'â',u'âœ…',u'ğŸ“³',u'ğŸ“´',u'ğŸ†š',u'ğŸ…°ï¸',u'ğŸ…±ï¸',u'ğŸ†',u'ğŸ†‘',u'ğŸ…¾ï¸'
                      ,u'ğŸ†˜',u'ğŸ†”',u'ğŸ…¿ï¸',u'ğŸš¾',u'ğŸ†’',u'ğŸ†“',u'ğŸ†•',u'ğŸ†–',u'ğŸ†—',u'ğŸ†™',u'ğŸ§',u'â™ˆï¸',u'â™‰ï¸',u'â™Šï¸',u'â™‹ï¸'
                      ,u'â™Œï¸',u'â™ï¸',u'â™ï¸',u'â™ï¸',u'â™ï¸',u'â™‘ï¸',u'â™’ï¸',u'â™“ï¸',u'ğŸš»',u'ğŸš¹',u'ğŸšº',u'ğŸš¼',u'â™¿ï¸',u'ğŸš°',u'ğŸš­'
                      ,u'ğŸš®',u'ğŸ”¢',u'ğŸ”¤',u'ğŸ”¡',u'ğŸ” ',u'ğŸ“¶']
emoji_set = set(emoji_list)
# çµµæ–‡å­—æ¤œå‡ºæ­£è¦è¡¨ç¾
emoji_g = u"("+u"|".join(emoji_list)+u")"
emoji_p = re.compile(emoji_g)

# URL ã®æ­£è¦è¡¨ç¾
url_p = re.compile(u"https?:[A-z/.0-9]*")
# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æ­£è¦è¡¨ç¾
account_p = re.compile(u"@[A-z_0-9]*")

emoji_freq = dict([(e,0) for e in emoji_list])
def update_emoji_freq(e):
    emoji_freq[e] += 1

word_freq = {}
def update_word_freq(w):
    if w not in word_freq:
        word_freq[w] = 1
    else:
        word_freq[w] += 1

emoji_with_emoji = dict([(e1,dict([(e2,0) for e2 in emoji_list])) for e1 in emoji_list])
def update_emoji_with_emoji(e1,e2):
    emoji_with_emoji[e1][e2] += 1
    if e1 != e2:
        emoji_with_emoji[e2][e1] += 1
    
emoji_with_word = dict([(e,{}) for e in emoji_list])
def update_emoji_with_word(e,w):
    if w not in emoji_with_word[e]:
        emoji_with_word[e][w] = 1
    else:
        emoji_with_word[e][w] += 1

# ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒªã‚¹ãƒˆã«åˆ†å‰²ã™ã‚‹é–¢æ•°
def split_sent(sentence):
    emoji_list = []
    word_list = []
    temp = emoji_p.split(sentence)
    if len(temp) < 2:
        return False
    else:
        for each in temp:
            if each in emoji_set:
                emoji_list.append(each)
            elif each:
                try:
                    chunks = cabocha.parsed2chunks(cabocha.parse(each.encode("utf-8")))
                    for c in chunks.values():
                        for m in c.morphs:
                            if m.pos in ["å‹•è©","å½¢å®¹è©","åè©"]:
                                if m.base == "*":
                                    word_list.append(m.surface)
                                else:
                                    word_list.append(m.base)
                except:
                    pass
        return emoji_list, word_list

tw = tweet_iter()
i = 0
while True:
    if i % 1000 == 0:
        print i
    i += 1
    line = tw.next()
    if not line:
        print "DONE"
        break
    temp  = split_sent(account_p.sub(" ACCOUNT ",url_p.sub(" URL ",line)))
    if temp:
        emoji_list, word_list = temp[0], temp[1]
        for e in emoji_list:
            update_emoji_freq(e)
        for w in word_list:
            update_word_freq(w)
        if len(emoji_list) > 1:
            for e1,e2 in itertools.combinations(emoji_list,2):
                update_emoji_with_emoji(e1,e2)
        for e, w in itertools.product(emoji_list,word_list):
             update_emoji_with_word(e,w)
    
data = {"emoji_with_emoji":emoji_with_emoji,
        "emoji_with_word":emoji_with_word,
        "emoji_freq":emoji_freq,
        "word_freq":word_freq}

with open(file_name + ".result.json", 'w') as f:
    json.dump(data, f)

